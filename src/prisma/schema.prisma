generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountStatus {
  ACTIVE
  BLOCKED
}

model UserAuth {
  cpf                Int       @id
  bcrypt_user        String
  bcrypt_transaction String
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
  // ================================================================================
  address            Address?
  user_info          UserInfo?
  accounts           Account[]
}

model Address {
  user_cpf      Int      @id
  cep           Int
  street        String
  number        Int
  complement    String
  neighbourhood String
  city          String
  state         String
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  // ================================================================================
  user          UserAuth @relation(fields: [user_cpf], references: [cpf])
}

model UserInfo {
  cpf        Int      @id
  name       String
  email      String
  phone      String
  birthday   DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  // ================================================================================
  user       UserAuth @relation(fields: [cpf], references: [cpf])
}

model Account {
  account_number     Int           @id
  agency             Int
  balance            Decimal
  owner_cpf          Int
  account_status     AccountStatus
  created_at         DateTime      @default(now())
  updated_at         DateTime      @updatedAt
  // ================================================================================
  user               UserAuth      @relation(fields: [owner_cpf], references: [cpf])
  sent_transfers     Transfer[]    @relation(name: "Debitos")
  received_transfers Transfer[]    @relation(name: "Creditos")
}

model Transfer {
  id                  String    @id @default(uuid())
  account_number_from Int
  account_number_to   Int
  value               Decimal
  scheduled           DateTime?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  // ================================================================================
  conta_debitada      Account   @relation(name: "Debitos", fields: [account_number_from], references: [account_number])
  conta_creditada     Account   @relation(name: "Creditos", fields: [account_number_to], references: [account_number])
}
